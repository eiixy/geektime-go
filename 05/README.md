# 第五周 Go 架构实践 - 微服务（微服务可用性设计）
> 本周作业： 总结限流，熔断，降级的常用方式，重试的注意事项，负载均衡的常用方式。



## 1. 限流，熔断，降级的常用方式
### 限流
常见限流算法：计数器算法、滑动窗口，令牌桶、漏桶算法
限流的维度：
- 对单节点限流
- 基于QPS限流
- 对租户进行限流
- 按优先级丢弃请求
分布式限流：
最大最小公平分享（Max-Min Fairness）

### 熔断
断路器（Circuit Breakers）: 为了限制操作的持续时间，我们可以使用超时，超时可以防止挂起操作并保证系统可以响应。因为我们处于高度动态的环境中，几乎不可能确定在每种情况下都能正常工作的准确的时间限制。断路器以现实世界的电子元件命名，因为它们的行为是都是相同的。断路器在分布式系统中非常有用，因为重复的故障可能会导致雪球效应，并使整个系统崩溃。
   
Google SRE
`max(0, (requests - K*accepts) / (requests + 1))`  

### 降级
降级本质为: 提供有损服务。
UI 模块化，非核心模块降级。BFF 层聚合 API，模块降级。
页面上一次缓存副本。
默认值、热门推荐等。 流量拦截 + 定期数据缓存(过期副本策略)。
处理策略
- 页面降级、延迟服务、写/读降级、缓存降级
- 抛异常、返回约定协议、Mock 数据、Fallback 处理

## 2. 重试的注意事项
- Nginx upstream retry 过大，导致服务雪崩。
- 业务不幂等，导致的重试，数据重复。
- 多层级重试传递，放大流量引起雪崩。

## 3. 负载均衡的常用方式
- 均衡的流量分发。
- 可靠的识别异常节点。
- scale-out，增加同质节点扩容。
- 减少错误，提高可用性。
